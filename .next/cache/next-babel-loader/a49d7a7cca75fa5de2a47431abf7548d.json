{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport axios from 'axios';\nimport xml from 'fast-xml-parser';\nimport config from 'config.json';\nimport { Moment } from './common';\nimport { TimeUI } from './ui';\n\nvar BusUI = /*#__PURE__*/function () {\n  function BusUI() {\n    _classCallCheck(this, BusUI);\n  }\n\n  _createClass(BusUI, null, [{\n    key: \"setWaitingTime\",\n    value: function setWaitingTime(target, sec, stId, busRouteId, ord) {\n      var ui = new TimeUI();\n      ui.setWaitingTimeWithBus(target, sec, BusUI.setCurrentBus, stId, busRouteId, ord);\n    }\n  }, {\n    key: \"setCurrentBus\",\n    value: function setCurrentBus(target, stId, busRouteId, ord) {\n      var api = new BusAPI();\n      api.getDataByRoute(stId, busRouteId, ord).then(function (data) {\n        if (data) {\n          var bus = new Bus(data);\n          var waitingSec = bus.getWaitingSec();\n\n          if (waitingSec < 1) {\n            target.text(bus.message);\n          } else {\n            BusUI.setWaitingTime(target, waitingSec, stId, busRouteId, ord);\n          }\n        } else {\n          target.text('data is null');\n        }\n      });\n    }\n  }]);\n\n  return BusUI;\n}();\n\nvar BusAPI = /*#__PURE__*/function () {\n  function BusAPI() {\n    _classCallCheck(this, BusAPI);\n\n    _defineProperty(this, \"API_KEY\", config.BUS_API_KEY);\n\n    _defineProperty(this, \"PROXY_HOST\", config.API_HOST);\n  }\n\n  _createClass(BusAPI, [{\n    key: \"proxy\",\n    value: function proxy(url) {\n      return axios.get(this.PROXY_HOST + '/apis/proxy?url=' + encodeURIComponent(url)).then(function (response) {\n        var data = xml.parse(response.data.data.data).ServiceResult.msgBody;\n        return data ? data.itemList : undefined;\n      })[\"catch\"](function (error) {\n        console.log(error);\n        return undefined;\n      });\n    }\n  }, {\n    key: \"createBus\",\n    value: function createBus(name, stationId, busRouteId, ord, token) {\n      var form = new FormData();\n      form.append('name', name);\n      form.append('station_id', stationId);\n      form.append('bus_route_id', busRouteId);\n      form.append('ord', ord);\n      form.append('token', token);\n      return axios.post(\"\".concat(this.PROXY_HOST, \"/public_transport/buses/create\"), form).then(function (response) {\n        return response.data.data;\n      })[\"catch\"](function (error) {\n        console.log(error);\n        return {};\n      });\n    }\n  }, {\n    key: \"deleteBus\",\n    value: function deleteBus(id, token) {\n      return axios[\"delete\"](\"\".concat(this.PROXY_HOST, \"/public_transport/buses/\").concat(id, \"/delete?token=\").concat(token)).then(function (response) {\n        return response.data;\n      })[\"catch\"](function (error) {\n        console.log(error);\n        return {};\n      });\n    }\n  }, {\n    key: \"getBuses\",\n    value: function getBuses(token) {\n      return axios.get(\"\".concat(this.PROXY_HOST, \"/public_transport/buses?token=\").concat(token)).then(function (response) {\n        return response.data.data.buses;\n      })[\"catch\"](function (error) {\n        console.log(error);\n        return [];\n      });\n    }\n  }, {\n    key: \"getBusRoute\",\n    value: function getBusRoute(arsId) {\n      var url = 'http://ws.bus.go.kr/api/rest/stationinfo/getStationByUid?';\n      url += 'serviceKey=' + this.API_KEY;\n      url += '&arsId=' + arsId;\n      return this.proxy(url);\n    }\n  }, {\n    key: \"getBusStation\",\n    value: function getBusStation(name) {\n      var url = 'http://ws.bus.go.kr/api/rest/stationinfo/getStationByName?';\n      url += 'serviceKey=' + this.API_KEY;\n      url += '&stSrch=' + name;\n      return this.proxy(url);\n    }\n  }, {\n    key: \"getDataByRoute\",\n    value: function getDataByRoute(stId, busRouteId, ord) {\n      var url = 'http://ws.bus.go.kr/api/rest/arrive/getArrInfoByRoute?';\n      url += 'serviceKey=' + this.API_KEY;\n      url += '&stId=' + stId;\n      url += '&busRouteId=' + busRouteId;\n      url += '&ord=' + ord;\n      return this.proxy(url);\n    }\n  }]);\n\n  return BusAPI;\n}();\n\nvar BusMessage = /*#__PURE__*/function () {\n  function BusMessage(message) {\n    _classCallCheck(this, BusMessage);\n\n    _defineProperty(this, \"message\", void 0);\n\n    this.message = message;\n  }\n\n  _createClass(BusMessage, [{\n    key: \"getWaitingSec\",\n    value: function getWaitingSec() {\n      var matchMinute = this.message.match(/\\d+분/g);\n      var minute = matchMinute ? parseInt(matchMinute[0].replace('분', '')) : 0;\n      var matchSec = this.message.match(/\\d+초/g);\n      var sec = matchSec ? parseInt(matchSec[0].replace('초', '')) : 0;\n      return minute * 60 + sec;\n    }\n  }, {\n    key: \"checkBusShutdown\",\n    value: function checkBusShutdown() {\n      if (this.message.search(/운행종료/g) != -1) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }]);\n\n  return BusMessage;\n}();\n\nvar Bus = /*#__PURE__*/function () {\n  function Bus(data) {\n    _classCallCheck(this, Bus);\n\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"busNum\", void 0);\n\n    _defineProperty(this, \"message\", void 0);\n\n    _defineProperty(this, \"apiCallTime\", void 0);\n\n    this.data = data;\n    this.busNum = parseInt(this.data.rtNm);\n    this.message = this.data.arrmsg1;\n    this.apiCallTime = this.data.mkTm;\n  }\n\n  _createClass(Bus, [{\n    key: \"getCorrectionSec\",\n    value: function getCorrectionSec() {\n      var m = new Moment();\n      return m.getCorrectionSec(this.apiCallTime);\n    }\n  }, {\n    key: \"getWaitingSec\",\n    value: function getWaitingSec() {\n      var bm = new BusMessage(this.message);\n      return bm.getWaitingSec() - this.getCorrectionSec();\n    }\n  }]);\n\n  return Bus;\n}();\n\nexport { BusUI, BusAPI };","map":null,"metadata":{},"sourceType":"module"}