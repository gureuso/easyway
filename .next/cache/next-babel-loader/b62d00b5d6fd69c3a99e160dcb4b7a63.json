{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport axios from 'axios';\nimport { Moment } from './common';\nimport { TimeUI } from './ui';\nimport config from 'config.json';\n\nclass SubwayUI {\n  static setWaitingTime(target, sec, stationName, trainLineName) {\n    const ui = new TimeUI();\n    ui.setWaitingTimeWithSubway(target, sec, SubwayUI.setCurrentSubway, stationName, trainLineName);\n  }\n\n  static setCurrentSubway(target, stationName, trainLineName) {\n    const api = new SubwayAPI();\n    api.getCurrentSubway(stationName).then(data => {\n      for (let d of data) {\n        if (d.trainLineNm == trainLineName) {\n          const subway = new Subway(d);\n          const waitingSec = subway.getWaitingSec();\n\n          if (waitingSec < 1) {\n            target.text(subway.message);\n          } else {\n            SubwayUI.setWaitingTime(target, waitingSec, stationName, trainLineName);\n          }\n\n          break;\n        }\n      }\n    });\n  }\n\n}\n\nclass SubwayAPI {\n  constructor() {\n    _defineProperty(this, \"API_KEY\", config.SUBWAY_API_KEY);\n\n    _defineProperty(this, \"API_HOST\", config.API_HOST);\n  }\n\n  createSubway(stationName, direction, trainLineName, token) {\n    const form = new FormData();\n    form.append('station_name', stationName);\n    form.append('direction', direction);\n    form.append('train_line_name', trainLineName);\n    form.append('token', token);\n    return axios.post(`${this.API_HOST}/public_transport/subways/create`, form).then(response => {\n      return response.data.data;\n    }).catch(error => {\n      console.log(error);\n      return {};\n    });\n  }\n\n  deleteSubway(id, token) {\n    return axios.delete(`${this.API_HOST}/public_transport/subways/${id}/delete?token=${token}`).then(response => {\n      return response.data;\n    }).catch(error => {\n      console.log(error);\n      return {};\n    });\n  }\n\n  getSubways(token) {\n    return axios.get(`${this.API_HOST}/public_transport/subways?token=${token}`).then(response => {\n      return response.data.data.subways;\n    }).catch(error => {\n      console.log(error);\n      return [];\n    });\n  }\n\n  getCurrentSubway(stationName) {\n    const url = 'http://swopenAPI.seoul.go.kr/api/subway/' + this.API_KEY + '/json/realtimeStationArrival/0/100/' + stationName;\n    return axios.get(url).then(response => {\n      return response.data.realtimeArrivalList ? response.data.realtimeArrivalList : [];\n    }).catch(error => {\n      console.log(error);\n      return [];\n    });\n  }\n\n}\n\nclass Subway {\n  /*\n    updnLine '외선'\n    barvlDt\u001e 도착예정시간\n    recptnDt 생성시각\n    arvlCd 도착코드\n  */\n  constructor(data) {\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"apiCallTime\", void 0);\n\n    _defineProperty(this, \"waitingSec\", void 0);\n\n    _defineProperty(this, \"message\", void 0);\n\n    this.data = data;\n    this.apiCallTime = this.data.recptnDt;\n    this.waitingSec = parseInt(this.data.barvlDt);\n    this.message = this.data.arvlMsg2;\n  }\n\n  getCorrectionSec() {\n    const m = new Moment();\n    return m.getCorrectionSec(this.apiCallTime);\n  }\n\n  getWaitingSec() {\n    return this.waitingSec - this.getCorrectionSec();\n  }\n\n}\n\nexport { SubwayUI, SubwayAPI };","map":null,"metadata":{},"sourceType":"module"}