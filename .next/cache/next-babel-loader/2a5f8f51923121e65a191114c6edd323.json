{"ast":null,"code":"import _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _getIterator from \"@babel/runtime-corejs2/core-js/get-iterator\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport axios from 'axios';\nimport { Moment } from './common';\nimport { TimeUI } from './ui';\nimport config from 'config.json';\n\nvar SubwayUI =\n/*#__PURE__*/\nfunction () {\n  function SubwayUI() {\n    _classCallCheck(this, SubwayUI);\n  }\n\n  _createClass(SubwayUI, null, [{\n    key: \"setWaitingTime\",\n    value: function setWaitingTime(target, sec) {\n      var ui = new TimeUI();\n      ui.setWaitingTime(target, sec, SubwayUI.setCurrentSubway);\n    }\n  }, {\n    key: \"setCurrentSubway\",\n    value: function setCurrentSubway(target) {\n      var api = new SubwayAPI();\n      var res = api.getDaerimWithLine2();\n      res.then(function (data) {\n        if (data) {\n          var subway = new Subway(data);\n          var waitingSec = subway.getWaitingSec();\n\n          if (waitingSec < 1) {\n            target.text(subway.message);\n          } else {\n            SubwayUI.setWaitingTime(target, waitingSec);\n          }\n        } else {\n          target.text('data is null');\n        }\n      });\n    }\n  }]);\n\n  return SubwayUI;\n}();\n\nvar SubwayAPI =\n/*#__PURE__*/\nfunction () {\n  function SubwayAPI() {\n    _classCallCheck(this, SubwayAPI);\n\n    _defineProperty(this, \"API_KEY\", config.SUBWAY_API_KEY);\n  }\n\n  _createClass(SubwayAPI, [{\n    key: \"getCurrentSubway\",\n    value: function getCurrentSubway() {\n      var station = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '대림';\n      var url = 'http://swopenAPI.seoul.go.kr/api/subway/' + this.API_KEY + '/json/realtimeStationArrival/0/10/' + station;\n      return axios.get(url).then(function (response) {\n        return response.data.realtimeArrivalList ? response.data.realtimeArrivalList : [];\n      })[\"catch\"](function (error) {\n        console.log(error);\n        return [];\n      });\n    }\n  }, {\n    key: \"getDaerimWithLine2\",\n    value: function getDaerimWithLine2() {\n      return this.getCurrentSubway().then(function (list) {\n        var result = undefined;\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = _getIterator(list), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var data = _step.value;\n\n            if (data.updnLine = '외선') {\n              if (!result) {\n                result = data;\n              } else {\n                if (data.updnLine < result.updnLine) {\n                  result = data;\n                }\n              }\n            }\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n              _iterator[\"return\"]();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n\n        return result;\n      });\n    }\n  }]);\n\n  return SubwayAPI;\n}();\n\nvar Subway =\n/*#__PURE__*/\nfunction () {\n  /*\n    updnLine '외선'\n    barvlDt\u001e 도착예정시간\n    recptnDt 생성시각\n    arvlCd 도착코드\n  */\n  function Subway(data) {\n    _classCallCheck(this, Subway);\n\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"apiCallTime\", void 0);\n\n    _defineProperty(this, \"waitingSec\", void 0);\n\n    _defineProperty(this, \"message\", void 0);\n\n    this.data = data;\n    this.apiCallTime = this.data.recptnDt;\n    this.waitingSec = _parseInt(this.data.barvlDt);\n    this.message = this.data.arvlMsg2;\n  }\n\n  _createClass(Subway, [{\n    key: \"getCorrectionSec\",\n    value: function getCorrectionSec() {\n      var m = new Moment();\n      return m.getCorrectionSec(this.apiCallTime);\n    }\n  }, {\n    key: \"getWaitingSec\",\n    value: function getWaitingSec() {\n      return this.waitingSec - this.getCorrectionSec();\n    }\n  }]);\n\n  return Subway;\n}();\n\nexport { SubwayUI };","map":null,"metadata":{},"sourceType":"module"}